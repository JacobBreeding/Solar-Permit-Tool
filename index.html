<!DOCTYPE html>
<html>
<head>
    <title>Solar Permit Automation Tool</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #ffffff;
            color: #000000;
        }
        
        h1 {
            text-align: center;
            font-size: 24px;
            font-weight: bold;
            margin: 40px 0;
            text-transform: uppercase;
        }
        
        .container {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 20px;
            margin-top: 100px;
        }
        
        .main-button {
            background-color: #c0c0c0;
            border: none;
            padding: 20px 40px;
            font-size: 16px;
            font-weight: bold;
            text-transform: uppercase;
            cursor: pointer;
            width: 400px;
            text-align: center;
            color: #000000;
            transition: background-color 0.3s;
        }
        
        .main-button:hover {
            background-color: #a0a0a0;
        }
        
        .city-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 20px;
            margin-top: 50px;
        }
        
        .city-title {
            font-size: 20px;
            font-weight: bold;
            text-transform: uppercase;
            margin-bottom: 30px;
        }
        
        .city-button {
            background-color: #c0c0c0;
            border: none;
            padding: 15px 40px;
            font-size: 16px;
            font-weight: bold;
            text-transform: uppercase;
            cursor: pointer;
            width: 300px;
            text-align: center;
            color: #000000;
            transition: background-color 0.3s;
        }
        
        .city-button:hover {
            background-color: #a0a0a0;
        }
        
        .back-button {
            background-color: #c0c0c0;
            border: none;
            padding: 10px 30px;
            font-size: 14px;
            font-weight: bold;
            text-transform: uppercase;
            cursor: pointer;
            color: #000000;
            margin-top: 30px;
            transition: background-color 0.3s;
        }
        
        .back-button:hover {
            background-color: #a0a0a0;
        }
        
        .form-container {
            margin-top: 50px;
        }
        
        .form-title {
            font-size: 20px;
            font-weight: bold;
            text-transform: uppercase;
            text-align: center;
            margin-bottom: 10px;
        }
        
        .form-subtitle {
            font-size: 16px;
            font-weight: bold;
            text-transform: uppercase;
            margin-bottom: 30px;
        }
        
        .subhub-button {
            background-color: #c0c0c0;
            border: none;
            padding: 10px 20px;
            font-size: 14px;
            font-weight: bold;
            text-transform: uppercase;
            cursor: pointer;
            color: #000000;
            margin-bottom: 40px;
            transition: background-color 0.3s;
        }
        
        .subhub-button:hover {
            background-color: #a0a0a0;
        }
        
        .form-field {
            display: flex;
            align-items: center;
            margin-bottom: 15px;
            gap: 20px;
        }
        
        .field-label {
            font-weight: bold;
            text-transform: uppercase;
            width: 200px;
            font-size: 14px;
        }
        
        .field-input {
            flex: 1;
            padding: 8px;
            border: 1px solid #ccc;
            font-size: 14px;
        }
        
        .field-source {
            font-size: 12px;
            color: #666;
            text-transform: uppercase;
            width: 200px;
        }
        
        .action-buttons {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 15px;
            margin-top: 50px;
        }
        
        .generate-button {
            background-color: #c0c0c0;
            border: none;
            padding: 15px 40px;
            font-size: 16px;
            font-weight: bold;
            text-transform: uppercase;
            cursor: pointer;
            color: #000000;
            transition: background-color 0.3s;
        }
        
        .generate-button:hover {
            background-color: #a0a0a0;
        }
        
        .hidden {
            display: none;
        }
        
        .admin-container {
            margin-top: 50px;
        }
        
        .admin-title {
            font-size: 24px;
            font-weight: bold;
            text-transform: uppercase;
            text-align: center;
            margin-bottom: 50px;
        }
        
        .upload-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            margin-top: 50px;
            gap: 30px;
        }
        
        .upload-zone {
            border: 3px dashed #c0c0c0;
            padding: 50px;
            text-align: center;
            width: 400px;
            background-color: #f9f9f9;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .upload-zone:hover {
            border-color: #808080;
            background-color: #f0f0f0;
        }
        
        .upload-zone.dragover {
            border-color: #606060;
            background-color: #e8e8e8;
        }
        
        .upload-text {
            font-size: 16px;
            font-weight: bold;
            text-transform: uppercase;
            color: #666;
            margin-bottom: 10px;
        }
        
        .upload-subtext {
            font-size: 12px;
            color: #999;
        }
        
        .file-input {
            display: none;
        }
        
        .template-builder {
            display: flex;
            gap: 20px;
            margin-top: 20px;
            height: 80vh;
        }
        
        .field-palette {
            width: 250px;
            background-color: #f5f5f5;
            padding: 20px;
            border: 1px solid #ddd;
            overflow-y: auto;
        }
        
        .palette-title {
            font-size: 16px;
            font-weight: bold;
            text-transform: uppercase;
            margin-bottom: 20px;
            text-align: center;
        }
        
        .draggable-field {
            background-color: #c0c0c0;
            padding: 10px;
            margin-bottom: 10px;
            cursor: grab;
            text-align: center;
            font-size: 12px;
            font-weight: bold;
            text-transform: uppercase;
            border: 1px solid #999;
            transition: all 0.3s;
        }
        
        .draggable-field:hover {
            background-color: #a0a0a0;
            transform: translateY(-2px);
        }
        
        .draggable-field:active {
            cursor: grabbing;
        }
        
        .pdf-canvas-container {
            flex: 1;
            position: relative;
            border: 1px solid #ddd;
            background-color: white;
            overflow: auto;
        }
        
        .pdf-page {
            position: relative;
            margin: 20px auto;
            background-color: white;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }
        
        .dropped-field {
            position: absolute;
            background-color: rgba(52, 152, 219, 0.3);
            border: 2px solid #3498db;
            padding: 5px;
            font-size: 10px;
            font-weight: bold;
            color: #2c3e50;
            cursor: move;
            min-width: 100px;
            min-height: 25px;
            display: flex;
            align-items: center;
            justify-content: center;
            text-transform: uppercase;
        }
        
        .dropped-field:hover {
            background-color: rgba(52, 152, 219, 0.5);
        }
        
        .dropped-field.selected {
            border-color: #e74c3c;
            background-color: rgba(231, 76, 60, 0.3);
        }
        
        .builder-controls {
            position: fixed;
            bottom: 20px;
            right: 20px;
            display: flex;
            gap: 10px;
        }
        
        .control-button {
            background-color: #3498db;
            color: white;
            border: none;
            padding: 10px 20px;
            font-size: 14px;
            font-weight: bold;
            text-transform: uppercase;
            cursor: pointer;
            transition: background-color 0.3s;
        }
        
        .control-button:hover {
            background-color: #2980b9;
        }
        
        .control-button.delete {
            background-color: #e74c3c;
        }
        
        .control-button.delete:hover {
            background-color: #c0392b;
        }
    </style>
</head>
<body>
    <!-- Landing Page -->
    <div id="landingPage">
        <h1>Solar Permit Automation Tool</h1>
        <div class="container">
            <button class="main-button" onclick="showCitySelection()">
                Click Here to Create Permit
            </button>
            <button class="main-button" onclick="showAdminPage()">
                Click Here to Add or Edit City Permit
            </button>
        </div>
    </div>

    <!-- City Selection Page -->
    <div id="citySelectionPage" class="hidden">
        <div class="city-title">Choose Your City/Solar Permit</div>
        <button class="back-button" onclick="showLandingPage()">Go Back to Landing Page</button>
        
        <div class="city-container">
            <button class="city-button" onclick="selectCity('lees_summit', 'Lee\'s Summit, MO')">
                Lee's Summit, MO
            </button>
        </div>
    </div>

    <!-- Form Page -->
    <div id="formPage" class="hidden">
        <div class="form-title">Lee's Summit, MO</div>
        <div class="form-subtitle">Fill Permit Information</div>
        
        <button class="subhub-button" onclick="connectToSubHub()">Connect to SubHub</button>
        
        <div class="form-container">
            <div class="form-field">
                <label class="field-label">Customer Name:</label>
                <input type="text" class="field-input" id="customerName">
                <span class="field-source">Flat Enter or Pull from SubHub</span>
            </div>
        </div>
        
        <div class="action-buttons">
            <button class="generate-button" onclick="generatePermit()">
                Generate Permit Application
            </button>
            <button class="back-button" onclick="showLandingPage()">
                Go Back to Landing Page
            </button>
        </div>
    </div>

    <!-- Admin Page -->
    <div id="adminPage" class="hidden">
        <div class="admin-title">Add or Edit Existing City</div>
        
        <div class="city-container">
            <button class="city-button" onclick="addNewCity()">
                Add New City
            </button>
            <button class="city-button" onclick="editCity('lees_summit')">
                Lee's Summit, MO
            </button>
        </div>
        
        <div style="text-align: center; margin-top: 50px;">
            <button class="back-button" onclick="showLandingPage()">
                Go Back to Landing Page
            </button>
        </div>
    </div>

    <!-- Upload Template Page -->
    <div id="uploadTemplatePage" class="hidden">
        <div class="admin-title">Add New City - Upload PDF Template</div>
        
        <div class="upload-container">
            <div class="upload-zone" onclick="document.getElementById('pdfFileInput').click()" 
                 ondrop="handleDrop(event)" ondragover="handleDragOver(event)" ondragleave="handleDragLeave(event)">
                <div class="upload-text">Click to Upload PDF Template</div>
                <div class="upload-subtext">or drag and drop PDF file here</div>
                <div class="upload-subtext">Supported format: PDF</div>
            </div>
            
            <input type="file" id="pdfFileInput" class="file-input" accept=".pdf" onchange="handleFileSelect(event)">
            
            <div>
                <input type="text" placeholder="Enter City Name (e.g., Springfield, MO)" 
                       id="newCityName" style="padding: 10px; width: 300px; margin-bottom: 20px;">
            </div>
        </div>
        
        <div style="text-align: center; margin-top: 50px;">
            <button class="back-button" onclick="showAdminPage()">
                Go Back to Admin
            </button>
        </div>
    </div>

    <!-- Template Builder Page -->
    <div id="templateBuilderPage" class="hidden">
        <div class="admin-title">PDF Template Builder - <span id="builderCityName">Lee's Summit, MO</span></div>
        
        <div class="template-builder">
            <!-- Field Palette -->
            <div class="field-palette">
                <div class="palette-title">Drag Fields to PDF</div>
                
                <div class="draggable-field" draggable="true" data-field-type="customerName">
                    Customer Name
                </div>
            </div>
            
            <!-- PDF Canvas -->
            <div class="pdf-canvas-container" ondrop="handleFieldDrop(event)" ondragover="allowDrop(event)">
                <canvas id="pdfCanvas" class="pdf-page"></canvas>
            </div>
        </div>
        
        <!-- Builder Controls -->
        <div class="builder-controls">
            <button class="control-button delete" onclick="deleteSelectedField()" style="display: none;" id="deleteButton">
                Delete Field
            </button>
            <button class="control-button" onclick="saveTemplate()">
                Save Template
            </button>
            <button class="control-button" onclick="showAdminPage()">
                Cancel
            </button>
        </div>
    </div>

    <script>
        let selectedCity = null;
        let selectedCityName = '';
        let currentPdfFile = null;
        let droppedFields = [];
        let selectedField = null;
        
        function showLandingPage() {
            // Hide all pages
            document.getElementById('landingPage').classList.remove('hidden');
            document.getElementById('citySelectionPage').classList.add('hidden');
            document.getElementById('formPage').classList.add('hidden');
            document.getElementById('adminPage').classList.add('hidden');
            document.getElementById('uploadTemplatePage').classList.add('hidden');
            document.getElementById('templateBuilderPage').classList.add('hidden');
        }
        
        function showCitySelection() {
            document.getElementById('landingPage').classList.add('hidden');
            document.getElementById('citySelectionPage').classList.remove('hidden');
            document.getElementById('formPage').classList.add('hidden');
            document.getElementById('adminPage').classList.add('hidden');
            document.getElementById('uploadTemplatePage').classList.add('hidden');
            document.getElementById('templateBuilderPage').classList.add('hidden');
        }
        
        function showAdminPage() {
            document.getElementById('landingPage').classList.add('hidden');
            document.getElementById('citySelectionPage').classList.add('hidden');
            document.getElementById('formPage').classList.add('hidden');
            document.getElementById('adminPage').classList.remove('hidden');
            document.getElementById('uploadTemplatePage').classList.add('hidden');
            document.getElementById('templateBuilderPage').classList.add('hidden');
        }
        
        function showUploadPage() {
            document.getElementById('landingPage').classList.add('hidden');
            document.getElementById('citySelectionPage').classList.add('hidden');
            document.getElementById('formPage').classList.add('hidden');
            document.getElementById('adminPage').classList.add('hidden');
            document.getElementById('uploadTemplatePage').classList.remove('hidden');
            document.getElementById('templateBuilderPage').classList.add('hidden');
        }
        
        function showTemplateBuilder() {
            document.getElementById('landingPage').classList.add('hidden');
            document.getElementById('citySelectionPage').classList.add('hidden');
            document.getElementById('formPage').classList.add('hidden');
            document.getElementById('adminPage').classList.add('hidden');
            document.getElementById('uploadTemplatePage').classList.add('hidden');
            document.getElementById('templateBuilderPage').classList.remove('hidden');
        }
        
        function selectCity(cityId, cityName) {
            selectedCity = cityId;
            selectedCityName = cityName;
            
            // Show the form page
            document.getElementById('citySelectionPage').classList.add('hidden');
            document.getElementById('formPage').classList.remove('hidden');
        }
        
        function connectToSubHub() {
            // Dead function - just show a message, no actual connection
            alert('SubHub connection button clicked.\n\n(This is just a placeholder - no actual connection occurs)');
        }
        
        function generatePermit() {
            // Simple validation for customer name
            const customerName = document.getElementById('customerName').value.trim();
            
            if (!customerName) {
                document.getElementById('customerName').style.border = '2px solid #e74c3c';
                alert('Please enter customer name');
                return;
            } else {
                document.getElementById('customerName').style.border = '1px solid #ccc';
            }
            
            alert(`Permit application generated successfully for Lee's Summit, MO!\n\nCustomer: ${customerName}\n\n(This is a demo - no actual PDF is generated)`);
        }
        
        function addNewCity() {
            showUploadPage();
        }
        
        function editCity(cityId) {
            // Go to template builder for Lee's Summit
            document.getElementById('builderCityName').textContent = "Lee's Summit, MO";
            showTemplateBuilder();
            
            // Load sample PDF
            loadSamplePDF();
        }
        
        // PDF Upload Functions
        function handleDragOver(event) {
            event.preventDefault();
            event.currentTarget.classList.add('dragover');
        }
        
        function handleDragLeave(event) {
            event.currentTarget.classList.remove('dragover');
        }
        
        function handleDrop(event) {
            event.preventDefault();
            event.currentTarget.classList.remove('dragover');
            
            const files = event.dataTransfer.files;
            if (files.length > 0 && files[0].type === 'application/pdf') {
                handlePDFFile(files[0]);
            } else {
                alert('Please upload a PDF file');
            }
        }
        
        function handleFileSelect(event) {
            const file = event.target.files[0];
            if (file && file.type === 'application/pdf') {
                handlePDFFile(file);
            } else {
                alert('Please select a PDF file');
            }
        }
        
        function handlePDFFile(file) {
            const cityName = document.getElementById('newCityName').value.trim();
            if (!cityName) {
                alert('Please enter a city name first');
                return;
            }
            
            currentPdfFile = file;
            document.getElementById('builderCityName').textContent = cityName;
            
            // Load PDF into canvas
            loadPDFIntoCanvas(file);
            
            // Go to template builder
            showTemplateBuilder();
        }
        
        function loadPDFIntoCanvas(file) {
            const canvas = document.getElementById('pdfCanvas');
            const ctx = canvas.getContext('2d');
            
            // Create a sample form
            canvas.width = 612; // Standard letter width
            canvas.height = 792; // Standard letter height
            
            // Draw form background
            ctx.fillStyle = '#ffffff';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            // Draw form content
            ctx.fillStyle = '#000000';
            ctx.font = '16px Arial';
            ctx.fillText('LEE\'S SUMMIT SOLAR PERMIT APPLICATION', 50, 50);
            
            ctx.font = '12px Arial';
            ctx.fillText('Customer Information:', 50, 100);
            
            // Draw form lines
            for (let i = 0; i < 10; i++) {
                const y = 140 + (i * 40);
                ctx.strokeStyle = '#cccccc';
                ctx.beginPath();
                ctx.moveTo(50, y);
                ctx.lineTo(550, y);
                ctx.stroke();
            }
            
            alert('PDF loaded! Drag the "Customer Name" field onto the form where you want it to appear.');
        }
        
        function loadSamplePDF() {
            // Load sample PDF for editing existing cities
            const canvas = document.getElementById('pdfCanvas');
            const ctx = canvas.getContext('2d');
            
            canvas.width = 612;
            canvas.height = 792;
            
            ctx.fillStyle = '#ffffff';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            ctx.fillStyle = '#000000';
            ctx.font = '16px Arial';
            ctx.fillText('LEE\'S SUMMIT SOLAR PERMIT APPLICATION', 50, 50);
            
            ctx.font = '12px Arial';
            ctx.fillText('Customer Information:', 50, 100);
            
            for (let i = 0; i < 10; i++) {
                const y = 140 + (i * 40);
                ctx.strokeStyle = '#cccccc';
                ctx.beginPath();
                ctx.moveTo(50, y);
                ctx.lineTo(550, y);
                ctx.stroke();
            }
        }
        
        // Drag and Drop Functions for Fields
        document.addEventListener('DOMContentLoaded', function() {
            // Add drag start event to draggable field
            document.querySelectorAll('.draggable-field').forEach(field => {
                field.addEventListener('dragstart', function(e) {
                    e.dataTransfer.setData('text/plain', this.dataset.fieldType);
                    e.dataTransfer.setData('text/html', this.textContent);
                });
            });
        });
        
        function allowDrop(event) {
            event.preventDefault();
        }
        
        function handleFieldDrop(event) {
            event.preventDefault();
            
            const fieldType = event.dataTransfer.getData('text/plain');
            const fieldText = event.dataTransfer.getData('text/html');
            
            if (!fieldType) return;
            
            // Get drop position relative to the canvas container
            const rect = event.currentTarget.getBoundingClientRect();
            const x = event.clientX - rect.left;
            const y = event.clientY - rect.top;
            
            // Create dropped field element
            const droppedField = document.createElement('div');
            droppedField.className = 'dropped-field';
            droppedField.textContent = fieldText;
            droppedField.dataset.fieldType = fieldType;
            droppedField.style.left = x + 'px';
            droppedField.style.top = y + 'px';
            
            // Add click event to select field
            droppedField.addEventListener('click', function() {
                selectDroppedField(this);
            });
            
            // Add to container
            event.currentTarget.appendChild(droppedField);
            
            // Add to tracking array
            droppedFields.push({
                element: droppedField,
                fieldType: fieldType,
                x: x,
                y: y
            });
            
            console.log('Field dropped:', fieldType, 'at position:', x, y);
        }
        
        function selectDroppedField(fieldElement) {
            // Remove previous selection
            if (selectedField) {
                selectedField.classList.remove('selected');
            }
            
            // Select new field
            selectedField = fieldElement;
            fieldElement.classList.add('selected');
            
            // Show delete button
            document.getElementById('deleteButton').style.display = 'block';
            
            console.log('Field selected:', fieldElement.dataset.fieldType);
        }
        
        function deleteSelectedField() {
            if (selectedField) {
                console.log('Deleting field:', selectedField.dataset.fieldType);
                
                // Remove from DOM
                selectedField.remove();
                
                // Remove from tracking array
                droppedFields = droppedFields.filter(field => field.element !== selectedField);
                
                // Clear selection
                selectedField = null;
                document.getElementById('deleteButton').style.display = 'none';
            }
        }
        
        function saveTemplate() {
            if (droppedFields.length === 0) {
                alert('Please add the Customer Name field to the template before saving');
                return;
            }
            
            // Create template configuration
            const templateConfig = {
                cityName: "Lee's Summit, MO",
                fields: droppedFields.map(field => ({
                    fieldType: field.fieldType,
                    x: field.x,
                    y: field.y,
                    width: field.element.offsetWidth,
                    height: field.element.offsetHeight
                }))
            };
            
            // Update existing templates
            existingTemplates['lees_summit'] = {
                name: "Lee's Summit, MO",
                hasTemplate: true,
                fields: templateConfig.fields
            };
            
            console.log('Template saved:', templateConfig);
            
            let message = '';
            if (isEditingExisting) {
                message = `Template updated successfully for Lee's Summit, MO!\n\nFields mapped: ${droppedFields.length}\n\n(Existing template was replaced)`;
            } else {
                message = `Template saved successfully for Lee's Summit, MO!\n\nFields mapped: ${droppedFields.length}\n\n(New template created)`;
            }
            
            alert(message + '\n\n(This is a demo - template is not actually saved to database)');
            
            // Reset and go back to admin
            resetBuilder();
            showAdminPage();
        }
        
        function replaceTemplate() {
            if (confirm('Are you sure you want to replace the existing PDF template?\n\nThis will:\n- Remove the current template\n- Clear all field mappings\n- Allow you to upload a new PDF\n\nThis action cannot be undone.')) {
                
                // Clear current template
                clearCurrentTemplate();
                
                // Go to upload page to select new template
                document.getElementById('newCityName').value = "Lee's Summit, MO";
                showUploadPage();
                
                alert('Template cleared! Please upload the new PDF template.');
            }
        }
        
        function clearCurrentTemplate() {
            // Clear dropped fields from canvas
            const canvas = document.querySelector('.pdf-canvas-container');
            const droppedElements = canvas.querySelectorAll('.dropped-field');
            droppedElements.forEach(element => element.remove());
            
            // Reset tracking arrays
            droppedFields = [];
            selectedField = null;
            
            // Hide buttons
            document.getElementById('deleteButton').style.display = 'none';
            document.getElementById('replaceTemplateButton').style.display = 'none';
            
            // Clear canvas
            const canvasElement = document.getElementById('pdfCanvas');
            const ctx = canvasElement.getContext('2d');
            ctx.clearRect(0, 0, canvasElement.width, canvasElement.height);
            
            console.log('Template cleared');
        }
        
        function loadExistingFields(fields) {
            // Load previously saved field positions
            fields.forEach(fieldConfig => {
                const droppedField = document.createElement('div');
                droppedField.className = 'dropped-field';
                droppedField.textContent = 'Customer Name'; // Clean text
                droppedField.dataset.fieldType = fieldConfig.fieldType;
                droppedField.style.left = fieldConfig.x + 'px';
                droppedField.style.top = fieldConfig.y + 'px';
                droppedField.style.width = fieldConfig.width + 'px';
                droppedField.style.height = fieldConfig.height + 'px';
                
                // Make the field draggable
                makeFieldDraggable(droppedField);
                
                // Add click event to select field
                droppedField.addEventListener('click', function(e) {
                    e.stopPropagation();
                    selectDroppedField(this);
                });
                
                // Add to canvas container
                document.querySelector('.pdf-canvas-container').appendChild(droppedField);
                
                // Add to tracking array
                droppedFields.push({
                    element: droppedField,
                    fieldType: fieldConfig.fieldType,
                    x: fieldConfig.x,
                    y: fieldConfig.y
                });
            });
            
            console.log('Loaded existing fields:', fields.length);
        }
        
        function resetBuilder() {
            // Clear all states
            droppedFields = [];
            selectedField = null;
            isEditingExisting = false;
            currentPdfFile = null;
            
            // Hide buttons
            document.getElementById('deleteButton').style.display = 'none';
            document.getElementById('replaceTemplateButton').style.display = 'none';
            
            // Clear form inputs
            document.getElementById('newCityName').value = '';
        }
    </script>
</body>
</html>
